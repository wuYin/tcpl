## 第2章 类型、运算符与表达式

介绍 C 的常量、数据类型、类型转换、运算符及其优先级、三元表达式等。

### 2.1 变量名

库文件常用 `_` 开头，变量命名尽量不使用 `_` 开头。



### 2.2 数据类型及长度

char 占 1 个字节，但 `short <= int <= long`，`float <= double <= long double` 的字节数与编译器实现有关。short 和 long 都是限定符，使用时类型 short 是 short int 的缩写，各类型极限值参考 `limits.h`



### 2.3 常量

前缀 0 八进制，0x/0X 十六进制，对于 0-255 的 ASCII 码，可用三个八进制数 `\ooo` 或两个十六进制数 `\xhh` 来表示。其中空字符`NULL` 的 ASCII 编码是 0，值本身也是 0，条件表达式中为假。后缀 l/L long，f/F float，u/U unsigned

编译时会连接多个字符串常量，必须是常量：

```c
main()
{
    char str[] = "hello, " // 编译时连接，必须是字符串常量
                 "world"
                 "\n";
    printf("%s", str); // hello, world
}
```

```c
enum NUMBER {
    zero, // 从 0 自动生成整型常量值
    two = 2,
    three, // 3
};
```



### 2.4 声明

const 声明的数组，其元素不能被修改：`error: read-only variable is not assignable`

### 2.5 算术运算符

### 2.6 关系运算符与逻辑运算符



### 2.7 类型转换

强制类型转换时，float 转 int 会直接截断小数部分，double 转 float 则会进位：

```c
printf("%d\n", (int)1.5);          // 1
printf("%f\n", (float)1.55555555); // 1.555556
```

头文件 `ctype.h` 有 `isdigit(c)`, `tolower(c)` 等字符类型操作函数。

注意 float 不会自动转为 double，相比其存储空间和运算时间都更低，可用于优化。

函数原型中参数声明类型后，在调用时会将实参的值强转为声明的类型。



### 2.8 自增运算符与自减运算符

警惕 `++ / —` 运算符的副作用：在对表达式求值时，修改了变量的值：

```c
main()
{
    char s[] = "hello";
    int i = 0;
    while (s[i] != '\0')
        i++;
    printf("%d\n", i);    // 5 // ok
}

main()
{
    char s[] = "hello";
    int i = 0;
    while (s[i++] != '\0') // 不应把条件自增/自减的逻辑提前到条件表达式中
        ;
    printf("%d\n", i);     // 6 // not ok
}
```



### 2.9 按位运算符

```c
&      // 按位与：屏蔽指定的位
|      // 按位或：将指定位置为 1
x << n // x 的二进制整体左移 n 位，右侧补 0，结果为 x*pow(2,n)
x >> n // 右移 n 位，x/power(2,n)
```



### 2.10 赋值运算符与表达式

注意连写的赋值运算符：`exp1 += exp2` 等价于 `exp1 = exp1 + exp2`，赋值运算符优先级最低，exp2 作为整体参与运算。



### 2.11 条件表达式



### 2.12 运算符优先级与求值次序

注意 C 语言没有规定同一运算符中多个参数的求值顺序：

```c
int res = f1() + f2(); // 不同编译器，f1 与 f2 执行顺序不定，若二者内部公用全局变量，则可能有副作用
```

